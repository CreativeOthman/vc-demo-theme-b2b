angular.module('storefront.account')
.component('vcRoles', {
    templateUrl: "themes/assets/roles.tpl.html.liquid",
    bindings: {
        rolesComponent: "=",
        member: "<",
        readonly: "@"
    },
    controller: ['$scope', 'roleService', 'loadingIndicatorService', function ($scope, roleService, loader) {
        var $ctrl = this;
        $ctrl.loader = loader;

        this.$onInit = function () {            
            $ctrl.rolesComponent = this;
        };

        this.$onDestroy = function () {
            $ctrl.rolesComponent = null;
        };

        $scope.$watch(function(){
            return roleService.available;
        }, function(){
            $ctrl.availableRoles = angular.copy(roleService.available);
            getCurrentRole();
        },);

        $ctrl.selectRole = function(role){
            if ($ctrl.currentRole)
                $ctrl.currentRole.assigned = false;
            role.assigned = true;
            $ctrl.currentRole = role;
        };

        $ctrl.$onChanges = function() {
			getCurrentRole();
        };

		var getCurrentRole = function() {
            if ($ctrl.member) {
                $ctrl.currentRole = roleService.get($ctrl.member);
            }		    
		};
    }]
});