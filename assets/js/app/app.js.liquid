var storefrontAppDependencies = [
    'ngStorage',
    'pascalprecht.translate',
    'ngSanitize',
    'ngAnimate',
    'ui.bootstrap',
    'ngWizard',
    'vcRecaptcha',
    'satellizer'
]
var storefrontApp = angular.module('storefrontApp', storefrontAppDependencies);

storefrontApp.constant('apiBaseUrl', '{{ application_settings['VirtoCommerce:B2B:ApiEndpoint'] }}');

storefrontApp.factory('httpErrorInterceptor', ['$q', '$rootScope', function ($q, $rootScope) {
    var httpErrorInterceptor = {};

    httpErrorInterceptor.responseError = function (rejection) {
        if (rejection.data && rejection.data.message) {
            $rootScope.$broadcast('storefrontError', {
                type: 'error',
                title: [rejection.config.method, rejection.config.url, rejection.status, rejection.statusText, rejection.data.message].join(' '),
                message: rejection.data.stackTrace,
            });
        }
        return $q.reject(rejection);
    };
    httpErrorInterceptor.requestError = function (rejection) {
        if (rejection.data && rejection.data.message) {
            $rootScope.$broadcast('storefrontError', {
                type: 'error',
                title: [rejection.config.method, rejection.config.url, rejection.status, rejection.statusText, rejection.data.message].join(' '),
                message: rejection.data.stackTrace,
            });
        }
        return $q.reject(rejection);
    };

    return httpErrorInterceptor;
}])

storefrontApp.config(['$httpProvider', '$translateProvider', 'wizardConfigProviderProvider', 'vcRecaptchaServiceProvider', function ($httpProvider, $translateProvider, wizardConfigProvider, vcRecaptchaServiceProvider) {
    $httpProvider.interceptors.push('httpErrorInterceptor');

    $translateProvider.useSanitizeValueStrategy('sanitizeParameters');
    $translateProvider.useUrlLoader(BASE_URL + 'themes/localization.json');
    $translateProvider.preferredLanguage('en');

    wizardConfigProvider.prevString = 'Back';
    wizardConfigProvider.nextString = 'Continue';
    wizardConfigProvider.submitString = 'Complete';

    vcRecaptchaServiceProvider.setSiteKey('6LeBhjsUAAAAAM-avRbZPkcbsu9eME8-8Na9_bYD')
}]);

storefrontApp.run(['$rootScope', '$window', function($rootScope, $window) {
    $rootScope.print = function() {
        $window.print();
    };
}]);
